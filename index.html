<!DOCTYPE html>
<html lang ="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>ABEL</title>
    <meta name="description" content=".">

    <!--
     -favicon
    -->
    <link rel = "shortcut icon" href = "favicon.svg" type = "image/svg+xml">

    <!--
     - google font link
    -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&
  display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/fonts/fonts.css">

    <!--
     - css link
    -->
    <link rel="stylesheet" href="./styles/style.css">

    <!--
      -preload images
    -->
    <link rel="preload" as="image" href="./imagens/imagemsEstonada.png">

</head>

<body>

  <!--
    - header
  -->
  <header class="header" data-header>
    <div class="container">
      <button class="nav-open-btn" aria-label="toggle menu" data-nav-toggler>
        <ion-icon name="menu-outline" aria-hidden="true"></ion-icon>
      </button>
      <a href="#" class="logo">
        <img src="./imagens/ABEL.png" width="132" height="27" alt="Logo do Abel">
      </a>

      <nav class="navbar" data-navbar>
        <ul class="navbar-list">
          <li class="navbar-link">
            <a href="#" class="navbar-link">Início</a>
          </li>
          <li class="navbar-link">
            <a href="#" class="navbar-link">Entrar</a>
          </li>
          <li class="navbar-link">
            <a href="#" class="navbar-link">Produtos</a>
          </li>
        </ul>

      </nav>

      <button class="cart-btn-left" id="open-cart-sidebar" aria-label="sacola" style="background:none;border:none;cursor:pointer;margin-left:10px;position:relative;">
        <span id="cart-count-badge" style="position:absolute;top:-8px;right:2px;z-index:-1;background:#2d6a4f;color:#fff;font-size:0.85rem;padding:2px 7px;border-radius:12px;min-width:22px;text-align:center;display:none;pointer-events:none;">0</span>
        <ion-icon name="bag" style="font-size:1.7rem;vertical-align:middle;"></ion-icon>
      </button>
    </div>
  </header>

  <main>
    <article>

      <!--
        Hero Section
      -->

      <div class="hero">
        <div class="container">

          <div class="hero-banner">
            <figure class="img-holder" style="--width: 704; --height: 700;">
              <img src="./imagens/imagemsEstonada.png" width="704" height="700"
              alt="hero-banner" class="img-cover">
            </figure>
          </div>

          </div>
        </div>
      </div>


      <!--
        Products Section
      -->
      
      <section class="section product section-destaques" aria-label="product">
        <div class="container" style="display: flex; flex-direction: column; align-items: center;">

          <h2 class="h2 section-title title text-center">DESTAQUES</h2>

          <ul class="product-list destaque-grid">

            <li class="scrollbar-item">
              <div class="product-card">

                <div class="card-banner">
                  <a href="#" class="btn product-btn">
                    <ion-icon name="bag" aria-hidden="true"></ion-icon>

                    <span class="span">Comprar</span>
                  </a>
                </div>
                
              </div>
            </li>
          </ul>
        </div>
      </section>
    </article>
  </main>

  <div id="cart-sidebar" style="position:fixed;top:0;right:-400px;width:350px;max-width:90vw;height:100vh;background:#fff;box-shadow:-4px 0 24px rgba(10,23,78,0.13);z-index:9999;transition:right 0.3s;display:flex;flex-direction:column;padding:32px 18px 18px 18px;">
    <button id="close-cart-sidebar" style="align-self:flex-end;background:none;border:none;font-size:2rem;cursor:pointer;margin-bottom:12px;">&times;</button>
    <h3 style="text-align:center;font-size:1.3rem;margin-bottom:18px;">Sacola</h3>
    <div id="cart-items" style="flex:1;overflow-y:auto;"></div>
    <div id="cart-total" style="font-weight:bold;font-size:1.1rem;margin:18px 0 10px 0;text-align:right;">Total: R$ 0,00</div>
    <a href="sacola.html" style="width:100%;display:block;text-align:center;background:#222;color:#fff;padding:12px 0;border-radius:8px;font-weight:bold;text-decoration:none;">Ir para Sacola</a>
  </div>
  <div id="cart-sidebar-overlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:9998;"></div>
    <!--
     - custom js link
    -->
    <script src="./scripts/script.js" defer></script>

    <script>
    // Redirecionar para login ao clicar em "Entrar"
    document.addEventListener('DOMContentLoaded', function() {
      const links = document.querySelectorAll('.navbar-link a');
      links.forEach(link => {
        const txt = link.textContent.trim().toLowerCase();
        if (txt === 'entrar') {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'login.html';
          });
        }
        if (txt === 'cadastrar') {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'cadastro.html';
          });
        }
        if (txt === 'sair') {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('tokenLogado');
            window.location.reload();
          });
        }
        if (txt === 'produtos') {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'produto.html';
          });
        }
      });
    });
    // Carregar produtos da Fake Store API
    document.addEventListener('DOMContentLoaded', function() {
      const productList = document.querySelector('.product-list');
      if (!productList) return;
      fetch('https://fakestoreapi.com/products')
        .then(res => res.json())
        .then(products => {
          productList.innerHTML = '';
          products.slice(0, 6).forEach(product => {
            const li = document.createElement('li');
            li.className = 'scrollbar-item';
            li.innerHTML = `
              <div class=\"product-card\">
                <div class=\"card-banner\">
                  <img src=\"${product.image}\" alt=\"${product.title}\" style=\"width:180px;height:180px;object-fit:contain;margin:auto 0 12px 0;display:block;\">
                  <a href=\"#\" class=\"btn product-btn\">
                    <ion-icon name=\"bag\" aria-hidden=\"true\"></ion-icon>
                    <span class=\"span\">Comprar</span>
                  </a>
                </div>
                <div class=\"product-info\" style=\"text-align:center;\">
                  <h3 style=\"font-size:1.3rem;margin:12px 0 6px 0;\">${product.title}</h3>
                  <span style=\"font-weight:bold;color:#2d6a4f;font-size:1.15rem;\">R$${product.price.toFixed(2)}</span>
                </div>
              </div>
            `;
            // Adicionar evento ao botão Comprar
            setTimeout(() => {
              const buyBtn = li.querySelector('.product-btn');
              if (buyBtn) {
                buyBtn.addEventListener('click', function(e) {
                  e.preventDefault();
                  let cart = JSON.parse(localStorage.getItem('carrinhoAbel') || '[]');
                  const prodId = product.id;
                  const found = cart.find(item => item.id === prodId);
                  if (found) {
                    found.qtd += 1;
                  } else {
                    cart.push({ id: prodId, title: product.title, price: product.price, image: product.image, qtd: 1 });
                  }
                  localStorage.setItem('carrinhoAbel', JSON.stringify(cart));
                  buyBtn.innerHTML = '<ion-icon name="checkmark-circle" style="color:#2d6a4f"></ion-icon> <span class="span">Adicionado!</span>';
                  setTimeout(() => {
                    buyBtn.innerHTML = '<ion-icon name="bag" aria-hidden="true"></ion-icon> <span class="span">Comprar</span>';
                  }, 1000);
                });
              }
            }, 0);
            productList.appendChild(li);
          });
        });
    });
    // Sidebar da sacola
    function renderCartSidebar() {
      const cart = JSON.parse(localStorage.getItem('carrinhoAbel') || '[]');
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      if (!cartItems || !cartTotal) return;
      if (cart.length === 0) {
        cartItems.innerHTML = '<p style="text-align:center;color:#888;">Sua sacola está vazia.</p>';
        cartTotal.textContent = 'Total: R$ 0,00';
        return;
      }
      let total = 0;
      cartItems.innerHTML = cart.map(item => {
        total += item.price * item.qtd;
        return `<div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;'>
          <img src='${item.image}' alt='' style='width:38px;height:38px;object-fit:contain;border-radius:6px;margin-right:8px;'>
          <span style='flex:1;font-size:0.98rem;'>${item.title.length > 15 ? item.title.slice(0,15)+'...' : item.title}</span>
          <span style='margin:0 8px;'>x${item.qtd}</span>
          <span style='font-weight:bold;'>R$${(item.price*item.qtd).toFixed(2)}</span>
        </div>
        <div style='display:flex;gap:6px;justify-content:flex-end;margin-bottom:18px;'>
          <button class='cart-minus' data-id='${item.id}' style='width:28px;height:28px;border-radius:50%;border:1px solid #aaa;background:#f7f7f7;font-size:1.1rem;cursor:pointer;'>-</button>
          <button class='cart-plus' data-id='${item.id}' style='width:28px;height:28px;border-radius:50%;border:1px solid #aaa;background:#f7f7f7;font-size:1.1rem;cursor:pointer;'>+</button>
          <button class='cart-remove' data-id='${item.id}' style='width:28px;height:28px;border-radius:50%;border:1px solid #e74c3c;background:#fff;color:#e74c3c;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;' title='Remover'><ion-icon name="trash-outline"></ion-icon></button>
        </div>`;
      }).join('');
      cartTotal.textContent = 'Total: R$ ' + total.toFixed(2);
      // Eventos para os botões de quantidade e remover
      setTimeout(() => {
        document.querySelectorAll('.cart-plus').forEach(btn => {
          btn.onclick = function() {
            const id = Number(this.dataset.id);
            let cart = JSON.parse(localStorage.getItem('carrinhoAbel') || '[]');
            const found = cart.find(item => item.id === id);
            if (found) found.qtd += 1;
            localStorage.setItem('carrinhoAbel', JSON.stringify(cart));
            renderCartSidebar();
          };
        });
        document.querySelectorAll('.cart-minus').forEach(btn => {
          btn.onclick = function() {
            const id = Number(this.dataset.id);
            let cart = JSON.parse(localStorage.getItem('carrinhoAbel') || '[]');
            const found = cart.find(item => item.id === id);
            if (found && found.qtd > 1) {
              found.qtd -= 1;
            } else {
              // Remove se chegar a 1 e clicar em -
              const idx = cart.findIndex(item => item.id === id);
              if (idx !== -1) cart.splice(idx, 1);
            }
            localStorage.setItem('carrinhoAbel', JSON.stringify(cart));
            renderCartSidebar();
          };
        });
        document.querySelectorAll('.cart-remove').forEach(btn => {
          btn.onclick = function() {
            const id = Number(this.dataset.id);
            let cart = JSON.parse(localStorage.getItem('carrinhoAbel') || '[]');
            cart = cart.filter(item => item.id !== id);
            localStorage.setItem('carrinhoAbel', JSON.stringify(cart));
            renderCartSidebar();
          };
        });
      }, 0);
    }
    document.getElementById('open-cart-sidebar').onclick = function() {
      renderCartSidebar();
      document.getElementById('cart-sidebar').style.right = '0';
      document.getElementById('cart-sidebar-overlay').style.display = 'block';
    };
    document.getElementById('close-cart-sidebar').onclick = function() {
      document.getElementById('cart-sidebar').style.right = '-400px';
      document.getElementById('cart-sidebar-overlay').style.display = 'none';
    };
    document.getElementById('cart-sidebar-overlay').onclick = function() {
      document.getElementById('cart-sidebar').style.right = '-400px';
      document.getElementById('cart-sidebar-overlay').style.display = 'none';
    };
    // Atualizar contador da sacola
    function updateCartCountBadge() {
      const badge = document.getElementById('cart-count-badge');
      let cart = JSON.parse(localStorage.getItem('carrinhoAbel') || '[]');
      const totalQtd = cart.reduce((sum, item) => sum + item.qtd, 0);
      if (totalQtd > 0) {
        badge.textContent = totalQtd;
        badge.style.display = 'inline-block';
      } else {
        badge.style.display = 'none';
      }
    }
    // Atualiza ao abrir sidebar, ao adicionar/remover produto e ao carregar página
    document.addEventListener('DOMContentLoaded', updateCartCountBadge);
    document.getElementById('open-cart-sidebar').addEventListener('click', updateCartCountBadge);
    // Atualiza também após qualquer alteração no carrinho
    const origSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
      origSetItem.apply(this, arguments);
      if (key === 'carrinhoAbel') updateCartCountBadge();
    };
    </script>

    <!--
      - ionicon link
    -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  </body>
</html>
